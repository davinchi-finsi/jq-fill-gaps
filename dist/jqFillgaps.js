$.widget("hz.fillgaps",{NAMESPACE:"fillgaps",ON_FILLGAPS_START:"fillgaps:start",ON_FILLGAPS_OVER:"fillgaps:over",ON_FILLGAPS_COMPLETED:"fillgaps:completed",ON_FILLGAPS_OK:"fillgaps_ok",CLASS_GAPS:"hz-fill-gaps-gap",CLASS_GAPS_OK:".hz-gap-evaluate-ko",options:{immediate_feedback:!0,classes:{"hz-fill-gaps":"hz-fill-gaps-default","hz-fill-gaps-gap":"hz-fill-gaps-gap"}},_create:function(){this._gaps=[],this._numberGaps,this._numberGapsFilled=0,this._buildHtml()},_init:function(){},_buildHtml:function(){var a=this.element.find(".hz-fill-gaps-gap");if(this._numberGaps=$(".hz-fill-gaps-gap").length,0==this._numberGaps)console.error("No se ha encontrado ning√∫n gap. Necesitas usar la clase hz-fill-gaps-gap");else{for(var i=0;i<a.length;i++)this._gaps.push({idGap:i,word:a[i].innerText}),$(a[i]).addClass("ui-droppable hz-fill-gaps-gap_destiny"),$(a[i]).attr("data-hz-fill-gaps-gap_destiny",i),$(a[i]).attr("data-hz-fill-gaps-gap_lenght",a[i].innerText.length),$(a[i]).html('<span class="gap_empty">?</span>');this._drawWords()}},_drawWords:function(){for(var a='<div class="hz-fill-gaps-gaps_origin">',i=this._shuffleArray(this._gaps),l=0;l<i.length;l++)a+='<div class="hz-fill-gaps-gap_origin ui-draggable" data-hz-fill-gaps-gap_origin="'+i[l].idGap+'">'+i[l].word+"</div>";a+="</div>",this.element.prepend(a),this._createEvents()},_createEvents:function(){var a=this;$(".hz-fill-gaps-gap_origin").draggable({revert:"valid",containment:"#actividad"}),$(".hz-fill-gaps-gap_destiny").droppable({hoverClass:"hover_destiny",drop:function(i,l){a._handleDrop(i,l,this)}})},_handleDrop:function(a,i,l){var e=this,s=i.helper,t=$(l),p=s.html(),n=s.attr("data-hz-fill-gaps-gap_origin"),g=t.attr("data-hz-fill-gaps-gap_destiny"),r="ko";n!=g&&p!=e._getWord(g)||(r="ok"),t.html('<span class="hz-gap-filled hz-gap-evaluate-'+r+'">'+p+"</span>"),s.remove(),"ko"==r&&e._handleGapFilled(n),e._numberGapsFilled=$(".hz-gap-filled").length,e._numberGapsOK=$(".hz-gap-evaluate-ok").length,e._numberGapsFilled==e._numberGaps&&e._trigger(this.ON_FILLGAPS_COMPLETED),e._numberGapsOK==e._numberGaps&&(e._trigger(this.ON_FILLGAPS_OK),e.element.find(".hz-fill-gaps-gaps_origin").remove())},_handleGapFilled:function(a){var i=this,l=this.element.find(this.CLASS_GAPS_OK),e="";l.on("click",function(){if(e=$(this).html(),$(this).removeClass("hz-gap-filled hz-gap-evaluate-ko"),$(this).addClass("gap_empty").html("?"),"?"!=e){var l=i.element.find(".hz-fill-gaps-gaps_origin"),s='<div class="hz-fill-gaps-gap_origin ui-draggable" data-hz-fill-gaps-gap_origin="'+a+'">'+e+"</div>";$(l).append(s),i._createEvents()}})},_getWord:function(a){for(var i=this._gaps,l=0;l<i.length;l++)if(a==i[l].idGap)return i[l].word},_shuffleArray:function(a){for(var i=a.length-1;i>0;i--){var l=Math.floor(Math.random()*(i+1)),e=a[i];a[i]=a[l],a[l]=e}return a}});